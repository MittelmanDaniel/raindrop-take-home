// ClickHouse SQL Grammar - Simplified for CFG
// Uses actual spaces and operators directly in rules

// ---------- Terminals ----------
IDENTIFIER: /[a-zA-Z_][a-zA-Z0-9_]*/
NUMBER: /[0-9]+/
STRING_LITERAL: /'[^']*'/

// ---------- SQL Keywords ----------
SELECT: "SELECT"
FROM: "FROM"
WHERE: "WHERE"
GROUP: "GROUP"
BY: "BY"
ORDER: "ORDER"
LIMIT: "LIMIT"
HAVING: "HAVING"
AS: "AS"
DISTINCT: "DISTINCT"
AND: "AND"
OR: "OR"
LIKE: "LIKE"
IN: "IN"
NOT: "NOT"
IS: "IS"
NULL: "NULL"
ASC: "ASC"
DESC: "DESC"
FORMAT: "FORMAT"
JSON: "JSON"
CASE: "CASE"
WHEN: "WHEN"
THEN: "THEN"
ELSE: "ELSE"
END: "END"
BETWEEN: "BETWEEN"

// ---------- Main query structure ----------
start: select_stmt " FORMAT JSON" [";"]

select_stmt: SELECT " " ["DISTINCT "] select_elements " FROM " table_name [where_clause] [group_by_clause] [having_clause] [order_by_clause] [limit_clause]

// ---------- Select elements ----------
select_elements: "*" | select_element | select_element ", " select_elements
select_element: column_expr | column_expr " AS " identifier | column_expr " " identifier

// ---------- Column expressions (simple - no binary operators to avoid ambiguity) ----------
column_expr: column_identifier
           | aggregate_func
           | function_call
           | literal
           | "(" column_expr ")"
           | "CASE " when_clause [" ELSE " column_expr] " END"
           | "CASE " when_clause " " when_clause [" ELSE " column_expr] " END"

column_identifier: identifier

// ---------- Functions ----------
function_call: identifier "(" function_args ")"
             | identifier "(DISTINCT " function_args ")"
             | identifier "()"
function_args: column_expr | column_expr ", " function_args

aggregate_func: count_func | sum_func | avg_func | min_func | max_func
count_func: "count(*)" | "count(DISTINCT " column_expr ")" | "count()"
sum_func: "sum(" column_expr ")"
avg_func: "avg(" column_expr ")"
min_func: "min(" column_expr ")"
max_func: "max(" column_expr ")"

// Fixed table name
table_name: "IBM_HR_Employee_Attrition"

// ---------- Clauses (operators allowed here) ----------
where_clause: " WHERE " condition
condition: predicate | condition " AND " condition | condition " OR " condition | "(" condition ")"
predicate: column_identifier " = " value
         | column_identifier " != " value
         | column_identifier " > " value
         | column_identifier " < " value
         | column_identifier " >= " value
         | column_identifier " <= " value
         | column_identifier " IS " ["NOT "] NULL
         | column_identifier [" NOT"] " LIKE " STRING_LITERAL
         | column_identifier [" NOT"] " IN (" value_list ")"
         | column_identifier " BETWEEN " value " AND " value

group_by_clause: " GROUP BY " group_by_list
group_by_list: column_identifier | column_identifier ", " group_by_list
having_clause: " HAVING " condition
order_by_clause: " ORDER BY " order_by_list
order_by_list: order_by_item | order_by_item ", " order_by_list
order_by_item: column_identifier [" ASC" | " DESC"]
limit_clause: " LIMIT " NUMBER

// ---------- Case expressions ----------
when_clause: "WHEN " condition " THEN " column_expr

// ---------- Literals and values ----------
literal: NUMBER | STRING_LITERAL | NULL
value: NUMBER | STRING_LITERAL | NULL
value_list: value | value ", " value_list

identifier: IDENTIFIER
